{% extends "base.html" %}

{% block title %}Client Health — Live Status{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 theme-text">Client Health — Live Status</h1>
</div>

<p class="theme-muted mb-4">Real-time health and status of every converted client.</p>

<div class="row g-3">
    {% for h in health_data %}
    <div class="col-md-6 col-lg-4">
        <div class="card metric-card h-100 {% if h.risk_count > 0 %}border-danger{% endif %}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <a href="{{ url_for('client_detail', id=h.client.id) }}" class="theme-link fw-bold">{{ h.client.name }}</a>
                    <span class="badge {% if h.health_score >= 70 %}bg-success{% elif h.health_score >= 40 %}bg-warning text-dark{% else %}bg-danger{% endif %} badge-status">{{ h.health_score }}</span>
                </div>
                <div class="small theme-muted mb-1">
                    <i class="bi bi-clock me-1"></i>Last update: {{ h.days_since_update|round(1) }} days ago
                </div>
                {% if h.risk_count > 0 %}
                <div class="small text-high-risk mb-1">
                    <i class="bi bi-exclamation-triangle me-1"></i>{{ h.risk_count }} unacknowledged risk flag(s)
                </div>
                {% endif %}
                {% if not h.guardrail_ok and h.guardrail_warnings %}
                <div class="small text-high-risk mb-1">
                    <i class="bi bi-shield-exclamation me-1"></i>Guardrail: {{ h.guardrail_warnings[0][:50] }}...
                </div>
                {% endif %}
                {% if h.can_view_confidential %}
                <div class="small theme-muted">
                    AI Readiness: {{ h.client.ai_readiness_score or 0 }} | Revenue: ${{ "{:,.0f}".format((h.client.services_revenue or 0) + (h.client.ai_product_revenue or 0)) }}
                </div>
                {% endif %}
                <a href="{{ url_for('client_detail', id=h.client.id) }}" class="btn btn-sm btn-outline-primary mt-2">View Details</a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="card metric-card">
            <div class="card-body theme-muted text-center py-5">No clients yet. Convert leads to get started.</div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
